<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name='viewport' content="width=device-width,user-scalable=no">
		<title></title>
		
		<style>
			#box{
				width: 200px;
				height: 300px;
				background: green;
				color:#fff;
				position: absolute;
				left:50px;
			}
			
		</style>
	</head>
	<body>
		<div id="box"></div>
		<script>
			/* 
				
			 */
			
			'use strict'
			var box=document.getElementById('box');
			var a=[];
			var b=[];
			var c=[];
			var d=[];
			var d1=0;
			function a2d(n){
			return n*180/Math.PI;
			};
			box.addEventListener('touchstart',function(ev){
				var oldD=d1;
				
				
				function getD(ev){
					var  x1= parseFloat(ev.touches[0].pageX).toFixed(1);
					var  y1= parseFloat(ev.touches[0].pageY).toFixed(1);
					
					var  x2= parseFloat(ev.touches[1].pageX).toFixed(1);
					var  y2= parseFloat(ev.touches[1].pageY).toFixed(1);
					
					var x = x2-x1;
					var y = y2-y1;
					
					var d1=a2d(Math.atan2(y,x));
					
					return d1;
					
				};
				
				if(ev.touches.length == 2){
					var downD = getD(ev);
				}
				
				document.addEventListener('touchmove',function(ev){
					if(ev.touches.length==2){
						d1=oldD+downD-getD(ev);
						
						box.style.webkitTransform='rotate('+d1+'deg)';
					}
				});
				
				box.innerHTML= `touches:${ev.touches.length}<br>odlD:${oldD}<br>downD:${downD}<br>d1:${d1}`;
				
				/* if(ev.touches[1]){
					var  x2= parseFloat(ev.touches[1].pageX).toFixed(1);
					var  y2= parseFloat(ev.touches[1].pageY).toFixed(1);
					
					var x = x2-x1;
					var y = y2-y1;
				}else{
					var x2=0;
					var y2=0;
				};
				var getD = a2d(Math.atan2(y,x));
				//box.innerHTML= `touches:${ev.touches.length}<br>changedTouches:${ev.changedTouches.length}<br>x1:${x1}<br>y1:${y1}<br>x2:${x2}<br>y2:${y2}<br>a:${a}<br>b:${b}`;
				
				if(ev.touches.length == 2){
					if(a[1]==undefined&&b[1]==undefined){
						this.style.background='blue';
					}
					
					}else{
						this.style.background='green';
					};
					
				if(ev.touches.length == 2){
					
					for(var i = ev.touches.length-1;i>0;i--){
						a[i]=a[i-1];
						b[i]=b[i-1];
						c[i]=c[i-1];
						d[i]=d[i-1];
					}
					
					a[0] = x1;
					b[0] = y1;
					c[0] = x2;
					d[0] = y2;
					
					
					
					x3=c[1]-a[1];
					y3=d[1]-b[1];
					var downD = a2d(Math.atan2(y3,x3));
					d1 = oldD + downD -getD;
					box.style.webkitTransform='rotate('+d1+'deg)';
					
					if(a[1]&&b[1]){
						if(a[1]!=x2||b[1]!=y2){
							this.style.background='black';
						};
						
						};
					};
				box.innerHTML= `touches:${ev.touches.length}<br>oldD:${oldD}<br>getD:${getD}<br>downD:${downD}<br>x2:${x2}<br>y2:${y2}<br>c:${c[1]}<br>d:${d[1]}<br>d:${d1}`; */
					
				});
				
			
		
			
		</script>
	</body>
</html>